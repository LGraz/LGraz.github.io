{
  "hash": "0f0cf64fea15a029680a6d0598106d67",
  "result": {
    "markdown": "---\ntitle: T-test vs Wilcoxon\nauthor: Lukas Graz\ndate: 2023-09-20\noutput:\n  pdf_document:\n    df_print: kable\n    toc: false\n    toc_depth: 2\n    number_sections: false\n    fig_width: 6.5\n    fig_height: 4.5\n    fig_caption: true\n    keep_tex: false\n    keep_md: false\n---\n\n::: {.cell}\n\n:::\n\n\n\nDefine a list of laws (i.e. distributions) with `mean` and `sd`. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# functions \nn <- 40 # per group\nlaws <- list(\n  norm = function(mean=0, sd=1) mean + sd *  rnorm(n, 0, 1),\n  logn = function(mean=0, sd=1) mean + sd * (rlnorm(n, sdlog=1) - 1.65) / 1.95,\n  exp1 = function(mean=0, sd=1) mean + sd * (rexp(n) - 1),\n  exp2 = function(mean=0, sd=1) mean + sd * (rexp(n)^2 - 2) / 3.94,\n  emix = function(mean=0, sd=1) mean + sd * (c(rep(0, n/2), rexp(n/2)) - 0.5) / 0.84\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123)\nget_data_all_laws <- function(){\n  dat <- lapply(names(laws), function(fname){\n    f <- laws[[fname]]\n    data.frame(y=f(), fun=fname)\n  }) \n  dat <- do.call(rbind, dat)\n  dat\n}\nboxplot(y ~ fun, get_data_all_laws(), main= \"Laws illustrated\")\n```\n\n::: {.cell-output-display}\n![](t-test_vs_wilcoxon_files/figure-pdf/boxplots-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\nverify mean and standard deviation\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsapply(laws, function(f) mean(replicate(10000, mean(f(0, 1)))))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     norm      logn      exp1      exp2      emix \n 1.55e-03 -2.89e-03 -1.66e-03 -8.53e-05 -1.32e-03 \n```\n:::\n\n```{.r .cell-code}\nsapply(laws, function(f) mean(replicate(10000, mean(f(1, 2)))))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n norm  logn  exp1  exp2  emix \n1.003 1.002 0.998 0.994 0.997 \n```\n:::\n\n```{.r .cell-code}\nsapply(laws, function(f) mean(replicate(10000,   sd(f(0, 1)))))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n norm  logn  exp1  exp2  emix \n0.994 1.008 0.977 0.999 1.000 \n```\n:::\n\n```{.r .cell-code}\nsapply(laws, function(f) mean(replicate(10000,   sd(f(1, 2)))))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nnorm logn exp1 exp2 emix \n1.99 2.01 1.96 1.99 2.00 \n```\n:::\n:::\n\n\n\nDefine the tests used\n\n\n::: {.cell}\n\n```{.r .cell-code}\npval_t <- function(d) t.test(y ~ group,d)$p.value\npval_w <- function(d) coin::pvalue(coin::wilcox_test(y ~ group, d))\npval_m <- function(d) coin::pvalue(coin::median_test(y ~ group, d))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# retuns data with f1() for group \"A\" and f2(mean2, sd2) for group \"B\"\nget_data <- function(f1, f2, mean2=0, sd2=1){\n  d <- rbind(\n    data.frame(\n      y=f1(),\n      group=\"A\"\n    ),\n    data.frame(\n      y=f2(mean2, sd2),\n      group=\"B\"\n    ))\n  d$group <- as.factor(d$group)\n  d\n}\n\n# get power of tests\nget_power <- function(f1, f2, nsim=1000, mean2=0, sd2=1) {\n  data_list <- replicate(nsim, get_data(f1, f2, mean2=mean2, sd2=sd2), simplify = FALSE)\n  c(t = mean(sapply(data_list, pval_t) < 0.05),\n    w = mean(sapply(data_list, pval_w) < 0.05),\n    m = mean(sapply(data_list, pval_m) < 0.05))\n}\n\n# get all combinations of functions\nfun_comb <- expand.grid(names(laws), names(laws)) |> as.matrix()\nrnames <- apply(fun_comb, 1, paste0, collapse=\"_\")\n\nsim <- function(nsim=1000, mean2=0, sd2=1) {\n  fun_comb_list <- split(fun_comb, row(fun_comb))\n  coverage <- parallel::mclapply(fun_comb_list, function(f_names){\n    f1 <- laws[[f_names[1]]]\n    f2 <- laws[[f_names[2]]]\n    get_power(f1, f2, nsim=nsim, mean2=mean2, sd2=sd2)\n  })\n  coverage <- do.call(rbind, coverage) \n  rownames(coverage) <- rnames\n  colnames(coverage) <- paste0(\n    colnames(coverage), \" \", as.character(mean2), \" \", as.character(sd2))\n  coverage |> as.data.frame()\n}\n```\n:::\n\n\n\n\n# Simulation\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnsim <- 10\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(4321)\nnull <- sim(nsim=nsim)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(4321)\ns_diff <- sim(nsim=nsim, sd2=2)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(4321)\ns_difff <- sim(nsim=nsim, sd2=5)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(4321)\nmu_diff <- sim(nsim=nsim, mean2 = 0.1)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(4321)\nmu_difff <- sim(nsim=nsim, mean2 = 0.2)\n```\n:::\n\n\n\n\\scriptsize\n\n\n::: {.cell}\n\n```{.r .cell-code}\nresults <- cbind(\n  null,\n  s_diff,\n  s_difff,\n  mu_diff,\n  mu_difff\n)\nresults * 100\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n          t 0 1 w 0 1 m 0 1 t 0 2 w 0 2 m 0 2 t 0 5 w 0 5 m 0 5 t 0.1 1 w 0.1 1\nnorm_norm     0     0    10    10    10    10    10    10    10       0       0\nlogn_norm     0    10    30     0     0     0     0    10    10       0      20\nexp1_norm    10    20    50    10    10    10    20    10    10       0       0\nexp2_norm    10    30    70     0    30    30     0    20    20      10      30\nemix_norm     0     0    40     0     0    10     0    20     0       0      30\nnorm_logn    30    20    20    10    40    40    10    70    70       0      10\nlogn_logn     0     0     0    10    30    20     0   100    90      10      10\nexp1_logn     0     0     0    10    70    20    20    90    90      10      20\nexp2_logn     0    20     0     0    40    20    10    90    80      10       0\nemix_logn     0    10    30     0    80    10    20    40    20       0      30\nnorm_exp1    10    20     0     0    10    30     0    60    70      10       0\nlogn_exp1     0     0     0    10    20    20    10    70    70       0       0\nexp1_exp1    10    10     0    10    40    10    10    40    40      20      20\n          m 0.1 1 t 0.2 1 w 0.2 1 m 0.2 1\nnorm_norm       0      10       0       0\nlogn_norm      40      10      40      60\nexp1_norm      20      20      20      30\nexp2_norm      70      20      40      80\nemix_norm      60      20      40      50\nnorm_logn      10      10      10      20\nlogn_logn       0      10      90      30\nexp1_logn      10      20      40      20\nexp2_logn      30      10      70      60\nemix_logn      30       0      90      30\nnorm_exp1      20      10       0       0\nlogn_exp1       0      10      20      10\nexp1_exp1      10      30      50      20\n [ reached 'max' / getOption(\"max.print\") -- omitted 12 rows ]\n```\n:::\n:::\n\n\n\\normalsize\n\n## Confidence intervals of ratios\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprop <- function(ratio, nsim){\n  confint_ <- prop.test(round(ratio*nsim), nsim)$conf.int[1:2]\n  names(confint_) <- c(\"lower\", \"upper\")\n   c( \n    ratio= ratio,\n    confint_\n)}\nsapply(c(0:4/40, 3:10/20), prop, nsim) |> as.data.frame() * 100\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        V1   V2   V3     V4     V5    V6    V7    V8    V9  V10  V11  V12  V13\nratio  0.0  2.5  5.0  7.500 10.000 15.00 20.00 25.00 30.00 35.0 40.0 45.0 50.0\nlower  0.0  0.0  0.0  0.524  0.524  3.54  3.54  3.54  8.09 13.7 13.7 13.7 23.7\nupper 34.5 34.5 34.5 45.885 45.885 55.78 55.78 55.78 64.63 72.6 72.6 72.6 76.3\n```\n:::\n:::\n\n\nthis gives an idea of the uncertainty of a ratio given 10 simulations\n\n# redo analysis but with groupwise equal medians\nDefine a list of laws (i.e. distributions) with `median` and `sd`\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# functions \nn <- 40 # per group\n# mean == to keep notation consistent\nlaws <- list(\n  norm = function(mean=0, sd=1) mean + sd *  rnorm(n, 0, 1)\n  ,logn = function(mean=0, sd=1) mean + sd * (rlnorm(n, sdlog=1) - 1.02) / 1.95\n  ,exp1 = function(mean=0, sd=1) mean + sd * (rexp(n) - 0.706)\n  ,exp2 = function(mean=0, sd=1) mean + sd * (rexp(n)^2 - 0.523) / 3.94\n  ,emix = function(mean=0, sd=1) mean + sd * (c(rep(0, n/2), rexp(n/2)) -0.025) / 0.84\n)\n```\n:::\n\n\n\nverify **median** and standard deviation\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsapply(laws, function(f) mean(replicate(10000, median(f(0, 1)))))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     norm      logn      exp1      exp2      emix \n-0.000142 -0.000216  0.002144  0.000204  0.000246 \n```\n:::\n\n```{.r .cell-code}\nsapply(laws, function(f) mean(replicate(10000, median(f(1, 2)))))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n norm  logn  exp1  exp2  emix \n1.000 1.001 0.998 1.000 0.999 \n```\n:::\n\n```{.r .cell-code}\nsapply(laws, function(f) mean(replicate(10000,     sd(f(0, 1)))))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n norm  logn  exp1  exp2  emix \n0.996 1.006 0.978 1.010 1.003 \n```\n:::\n\n```{.r .cell-code}\nsapply(laws, function(f) mean(replicate(10000,     sd(f(1, 2)))))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nnorm logn exp1 exp2 emix \n1.99 2.00 1.95 1.99 2.01 \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nboxplot(y ~ fun, get_data_all_laws(), main= \"Equal Medians (in expectation)\")\n```\n\n::: {.cell-output-display}\n![](t-test_vs_wilcoxon_files/figure-pdf/unnamed-chunk-9-1.pdf){fig-pos='H'}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(4321)\nnull_median <- sim(nsim=nsim)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(4321)\ns_diff_median <- sim(nsim=nsim, sd2=2)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(4321)\ns_difff_median <- sim(nsim=nsim, sd2=5)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(4321)\nmu_diff_median <- sim(nsim=nsim, mean2 = 0.1)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(4321)\nmu_difff_median <- sim(nsim=nsim, mean2 = 0.2)\n```\n:::\n\n\n\n\\scriptsize\n\n\n::: {.cell}\n\n```{.r .cell-code}\nresults_median <- cbind(\n  null_median,\n  s_diff_median,\n  s_difff_median,\n  mu_diff_median,\n  mu_difff_median\n)  \nresults_median * 100\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n          t 0 1 w 0 1 m 0 1 t 0 2 w 0 2 m 0 2 t 0 5 w 0 5 m 0 5 t 0.1 1 w 0.1 1\nnorm_norm    10    20    10     0     0    10    10    10    10      10      30\nlogn_norm    20    20    10    30    20    30     0     0     0      20      10\nexp1_norm    20    10     0    20    10     0     0    30    30      20      20\nexp2_norm    60    50    10    20    20     0    10    10    10      10       0\nemix_norm    80    70     0    30    30     0    10    30     0      60      30\nnorm_logn    30    10    10    40     0    10    50    10    10      30      20\nlogn_logn     0     0     0     0    10     0    10    20    20      10      20\nexp1_logn     0     0     0    10     0     0    20    20    10       0      20\nexp2_logn    10    40     0    10    30     0    20    10    10       0       0\nemix_logn    30    70     0     0    40     0    20    10     0      20      40\nnorm_exp1    10    10     0    30     0     0    50     0     0      70      40\nlogn_exp1     0    10     0    30    10     0    50    10    20       0       0\nexp1_exp1    10    10    10    20     0     0    20     0     0       0      10\n          m 0.1 1 t 0.2 1 w 0.2 1 m 0.2 1\nnorm_norm      30      10      20      20\nlogn_norm      20      10      10      10\nexp1_norm      10       0      10      20\nexp2_norm       0      10       0       0\nemix_norm      10      60      30       0\nnorm_logn       0      70      60      10\nlogn_logn      10      20      60      20\nexp1_logn       0      10      80      30\nexp2_logn      30      10      10      50\nemix_logn       0       0       0      10\nnorm_exp1      10      70      70      10\nlogn_exp1       0      10      30      20\nexp1_exp1      10      20      30      20\n [ reached 'max' / getOption(\"max.print\") -- omitted 12 rows ]\n```\n:::\n:::\n\n\n\\normalsize\n",
    "supporting": [
      "t-test_vs_wilcoxon_files/figure-pdf"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}