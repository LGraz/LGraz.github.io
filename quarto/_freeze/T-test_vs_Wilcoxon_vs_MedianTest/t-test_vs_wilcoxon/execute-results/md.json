{
  "hash": "76589a02fc4e07d8e5243f6e5891031b",
  "result": {
    "markdown": "---\ntitle: T-test vs Wilcoxon\nauthor: Lukas Graz\ndate: 2023-09-20\nformat:\n  gfm+yaml_metadata_block: \n    df-print: kable\n    comment: '#>'\n  # pdf:\n  #   df-print: kable\n  #   toc: false\n  #   toc-depth: 2\n  #   number-sections: false\n  #   fig-width: 6.5\n  #   fig-height: 4.5\n  #   fig-caption: true\n  #   keep-tex: false\n  #   keep-md: false\n---\n\n::: {.cell}\n\n:::\n\n\nDefine a list of laws (i.e. distributions) with `mean` and `sd`. \n\n::: {.cell}\n\n```{.r .cell-code}\n# functions \nn <- 40 # per group\nlaws <- list(\n  norm = function(mean=0, sd=1) mean + sd *  rnorm(n, 0, 1),\n  logn = function(mean=0, sd=1) mean + sd * (rlnorm(n, sdlog=1) - 1.65) / 1.95,\n  exp1 = function(mean=0, sd=1) mean + sd * (rexp(n) - 1),\n  exp2 = function(mean=0, sd=1) mean + sd * (rexp(n)^2 - 2) / 3.94,\n  emix = function(mean=0, sd=1) mean + sd * (c(rep(0, n/2), rexp(n/2)) - 0.5) / 0.84\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123)\nget_data_all_laws <- function(){\n  dat <- lapply(names(laws), function(fname){\n    f <- laws[[fname]]\n    data.frame(y=f(), fun=fname)\n  }) \n  dat <- do.call(rbind, dat)\n  dat\n}\nboxplot(y ~ fun, get_data_all_laws(), main= \"Laws illustrated\")\n```\n\n::: {.cell-output-display}\n![](t-test_vs_wilcoxon_files/figure-commonmark/boxplots-1.png)\n:::\n:::\n\n\nverify mean and standard deviation\n\n::: {.cell}\n\n```{.r .cell-code}\nsapply(laws, function(f) mean(replicate(10000, mean(f(0, 1)))))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     norm      logn      exp1      exp2      emix \n 1.55e-03 -2.89e-03 -1.66e-03 -8.53e-05 -1.32e-03 \n```\n:::\n\n```{.r .cell-code}\nsapply(laws, function(f) mean(replicate(10000, mean(f(1, 2)))))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n norm  logn  exp1  exp2  emix \n1.003 1.002 0.998 0.994 0.997 \n```\n:::\n\n```{.r .cell-code}\nsapply(laws, function(f) mean(replicate(10000,   sd(f(0, 1)))))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n norm  logn  exp1  exp2  emix \n0.994 1.008 0.977 0.999 1.000 \n```\n:::\n\n```{.r .cell-code}\nsapply(laws, function(f) mean(replicate(10000,   sd(f(1, 2)))))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nnorm logn exp1 exp2 emix \n1.99 2.01 1.96 1.99 2.00 \n```\n:::\n:::\n\n\nDefine the tests used\n\n::: {.cell}\n\n```{.r .cell-code}\npval_t <- function(d) t.test(y ~ group,d)$p.value\npval_w <- function(d) coin::pvalue(coin::wilcox_test(y ~ group, d))\npval_m <- function(d) coin::pvalue(coin::median_test(y ~ group, d))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# retuns data with f1() for group \"A\" and f2(mean2, sd2) for group \"B\"\nget_data <- function(f1, f2, mean2=0, sd2=1){\n  d <- rbind(\n    data.frame(\n      y=f1(),\n      group=\"A\"\n    ),\n    data.frame(\n      y=f2(mean2, sd2),\n      group=\"B\"\n    ))\n  d$group <- as.factor(d$group)\n  d\n}\n\n# get power of tests\nget_power <- function(f1, f2, nsim=1000, mean2=0, sd2=1) {\n  data_list <- replicate(nsim, get_data(f1, f2, mean2=mean2, sd2=sd2), simplify = FALSE)\n  c(t = mean(sapply(data_list, pval_t) < 0.05),\n    w = mean(sapply(data_list, pval_w) < 0.05),\n    m = mean(sapply(data_list, pval_m) < 0.05))\n}\n\n# get all combinations of functions\nfun_comb <- expand.grid(names(laws), names(laws)) |> as.matrix()\nrnames <- apply(fun_comb, 1, paste0, collapse=\"_\")\n\nsim <- function(nsim=1000, mean2=0, sd2=1) {\n  fun_comb_list <- split(fun_comb, row(fun_comb))\n  coverage <- parallel::mclapply(fun_comb_list, function(f_names){\n    f1 <- laws[[f_names[1]]]\n    f2 <- laws[[f_names[2]]]\n    get_power(f1, f2, nsim=nsim, mean2=mean2, sd2=sd2)\n  })\n  coverage <- do.call(rbind, coverage) \n  rownames(coverage) <- rnames\n  colnames(coverage) <- paste0(\n    colnames(coverage), \" \", as.character(mean2), \" \", as.character(sd2))\n  coverage |> as.data.frame()\n}\n```\n:::\n\n\n\n# Simulation\n\n::: {.cell}\n\n```{.r .cell-code}\nnsim <- 10\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(4321)\nnull <- sim(nsim=nsim)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(4321)\ns_diff <- sim(nsim=nsim, sd2=2)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(4321)\ns_difff <- sim(nsim=nsim, sd2=5)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(4321)\nmu_diff <- sim(nsim=nsim, mean2 = 0.1)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(4321)\nmu_difff <- sim(nsim=nsim, mean2 = 0.2)\n```\n:::\n\n\n\\scriptsize\n\n::: {.cell}\n\n```{.r .cell-code}\nresults <- cbind(\n  null,\n  s_diff,\n  s_difff,\n  mu_diff,\n  mu_difff\n)\nresults * 100\n```\n\n::: {.cell-output-display}\n|          | t 0 1| w 0 1| m 0 1| t 0 2| w 0 2| m 0 2| t 0 5| w 0 5| m 0 5| t 0.1 1| w 0.1 1| m 0.1 1| t 0.2 1| w 0.2 1| m 0.2 1|\n|:---------|-----:|-----:|-----:|-----:|-----:|-----:|-----:|-----:|-----:|-------:|-------:|-------:|-------:|-------:|-------:|\n|norm_norm |     0|     0|    10|     0|     0|    10|     0|     0|     0|      10|      10|      10|      40|      30|      10|\n|logn_norm |    20|    20|    40|    10|    20|    20|    20|    20|    20|      10|      20|      30|      20|      60|      80|\n|exp1_norm |     0|     0|     0|    10|    10|     0|     0|    20|    30|      10|      30|      30|      10|      50|      60|\n|exp2_norm |    10|    30|    70|     0|     0|    20|    10|    20|    10|       0|      20|      70|      10|      50|      90|\n|emix_norm |    10|    20|    30|    10|    20|    20|     0|    10|    20|       0|      20|      60|      10|      20|      60|\n|norm_logn |    20|    20|    30|    20|    50|    60|    10|    60|    70|      10|      10|      20|      20|      30|       0|\n|logn_logn |     0|    10|     0|     0|    40|    20|    10|    70|    50|      10|      30|      10|      30|      70|      20|\n|exp1_logn |     0|    10|     0|    10|    50|    50|     0|    80|    70|       0|      10|       0|      30|      40|      30|\n|exp2_logn |     0|    10|     0|    10|    80|    30|    10|    70|    60|       0|      10|      30|      20|      70|      70|\n|emix_logn |     0|     0|    10|     0|    40|     0|     0|    90|    20|       0|      40|      10|      20|      90|      70|\n|norm_exp1 |     0|    20|    10|     0|    20|    20|    10|    30|    40|       0|       0|      10|      20|      10|      20|\n|logn_exp1 |    20|    20|    10|     0|    40|    20|    10|    70|    70|       0|       0|       0|      10|      10|      10|\n|exp1_exp1 |    10|    10|    10|    10|    30|    20|    10|    70|    50|       0|      20|      10|       0|       0|      10|\n|exp2_exp1 |    10|    30|    20|     0|    10|    10|     0|    60|    50|      10|      10|      10|      30|      30|      50|\n|emix_exp1 |     0|     0|    10|     0|    50|     0|    20|    40|    10|       0|       0|      30|      20|      40|      60|\n|norm_exp2 |     0|    10|    40|     0|    50|    60|    30|   100|   100|      10|      20|      30|      10|      20|      30|\n|logn_exp2 |     0|    20|     0|    10|    90|    60|     0|   100|   100|      10|      60|      20|      20|      60|      10|\n|exp1_exp2 |     0|     0|    20|    10|    60|    40|    10|   100|    70|      10|      30|       0|      10|      40|      10|\n|exp2_exp2 |     0|     0|     0|    10|    80|    60|    30|   100|    90|      10|      70|      10|      20|      80|      60|\n|emix_exp2 |     0|    40|    20|    10|    90|     0|    10|    90|    40|       0|      70|      40|       0|     100|      60|\n|norm_emix |     0|    20|    50|     0|    50|    80|    10|   100|   100|       0|       0|      30|      10|       0|      30|\n|logn_emix |     0|     0|     0|     0|    90|    60|     0|   100|    80|       0|      20|       0|      40|      40|      10|\n|exp1_emix |     0|    10|    10|     0|    80|    50|     0|   100|    90|       0|      30|      10|       0|      30|       0|\n|exp2_emix |     0|    60|    20|     0|    90|    80|    10|    90|    90|       0|       0|       0|      10|      70|       0|\n|emix_emix |    10|     0|     0|     0|    90|     0|     0|    80|    20|       0|      80|       0|       0|     100|       0|\n:::\n:::\n\n\\normalsize\n\n## Confidence intervals of ratios\n\n::: {.cell}\n\n```{.r .cell-code}\nprop <- function(ratio, nsim){\n  confint_ <- prop.test(round(ratio*nsim), nsim)$conf.int[1:2]\n  names(confint_) <- c(\"lower\", \"upper\")\n   c( \n    ratio= ratio,\n    confint_\n)}\nsapply(c(0:4/40, 3:10/20), prop, nsim) |> as.data.frame() * 100\n```\n\n::: {.cell-output-display}\n|      |   V1|   V2|   V3|     V4|     V5|    V6|    V7|    V8|   V9|  V10|  V11|  V12|  V13|\n|:-----|----:|----:|----:|------:|------:|-----:|-----:|-----:|----:|----:|----:|----:|----:|\n|ratio |  0.0|  2.5|  5.0|  7.500| 10.000| 15.00| 20.00| 25.00| 30.0| 35.0| 40.0| 45.0| 50.0|\n|lower |  0.0|  0.0|  0.0|  0.524|  0.524|  3.54|  3.54|  3.54|  8.1| 13.7| 13.7| 13.7| 23.7|\n|upper | 34.5| 34.5| 34.5| 45.885| 45.885| 55.78| 55.78| 55.78| 64.6| 72.6| 72.6| 72.6| 76.3|\n:::\n:::\n\nthis gives an idea of the uncertainty of a ratio given 10 simulations\n\n# redo analysis but with groupwise equal medians\nDefine a list of laws (i.e. distributions) with `median` and `sd`\n\n::: {.cell}\n\n```{.r .cell-code}\n# functions \nn <- 40 # per group\n# mean == to keep notation consistent\nlaws <- list(\n  norm = function(mean=0, sd=1) mean + sd *  rnorm(n, 0, 1)\n  ,logn = function(mean=0, sd=1) mean + sd * (rlnorm(n, sdlog=1) - 1.02) / 1.95\n  ,exp1 = function(mean=0, sd=1) mean + sd * (rexp(n) - 0.706)\n  ,exp2 = function(mean=0, sd=1) mean + sd * (rexp(n)^2 - 0.523) / 3.94\n  ,emix = function(mean=0, sd=1) mean + sd * (c(rep(0, n/2), rexp(n/2)) -0.025) / 0.84\n)\n```\n:::\n\n\nverify **median** and standard deviation\n\n::: {.cell}\n\n```{.r .cell-code}\nsapply(laws, function(f) mean(replicate(10000, median(f(0, 1)))))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     norm      logn      exp1      exp2      emix \n-0.000142 -0.000216  0.002144  0.000204  0.000246 \n```\n:::\n\n```{.r .cell-code}\nsapply(laws, function(f) mean(replicate(10000, median(f(1, 2)))))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n norm  logn  exp1  exp2  emix \n1.000 1.001 0.998 1.000 0.999 \n```\n:::\n\n```{.r .cell-code}\nsapply(laws, function(f) mean(replicate(10000,     sd(f(0, 1)))))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n norm  logn  exp1  exp2  emix \n0.996 1.006 0.978 1.010 1.003 \n```\n:::\n\n```{.r .cell-code}\nsapply(laws, function(f) mean(replicate(10000,     sd(f(1, 2)))))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nnorm logn exp1 exp2 emix \n1.99 2.00 1.95 1.99 2.01 \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nboxplot(y ~ fun, get_data_all_laws(), main= \"Equal Medians (in expectation)\")\n```\n\n::: {.cell-output-display}\n![](t-test_vs_wilcoxon_files/figure-commonmark/unnamed-chunk-9-1.png)\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(4321)\nnull_median <- sim(nsim=nsim)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(4321)\ns_diff_median <- sim(nsim=nsim, sd2=2)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(4321)\ns_difff_median <- sim(nsim=nsim, sd2=5)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(4321)\nmu_diff_median <- sim(nsim=nsim, mean2 = 0.1)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(4321)\nmu_difff_median <- sim(nsim=nsim, mean2 = 0.2)\n```\n:::\n\n\n\\scriptsize\n\n::: {.cell}\n\n```{.r .cell-code}\nresults_median <- cbind(\n  null_median,\n  s_diff_median,\n  s_difff_median,\n  mu_diff_median,\n  mu_difff_median\n)  \nresults_median * 100\n```\n\n::: {.cell-output-display}\n|          | t 0 1| w 0 1| m 0 1| t 0 2| w 0 2| m 0 2| t 0 5| w 0 5| m 0 5| t 0.1 1| w 0.1 1| m 0.1 1| t 0.2 1| w 0.2 1| m 0.2 1|\n|:---------|-----:|-----:|-----:|-----:|-----:|-----:|-----:|-----:|-----:|-------:|-------:|-------:|-------:|-------:|-------:|\n|norm_norm |    10|    10|     0|    10|    10|    10|    10|    10|    10|      10|      20|      20|      20|      20|      10|\n|logn_norm |     0|    10|    10|    10|    10|     0|     0|     0|     0|      50|      40|      20|       0|      20|      30|\n|exp1_norm |    30|    10|    10|    20|    10|     0|     0|     0|     0|      10|       0|       0|      10|      10|      30|\n|exp2_norm |    20|    10|    30|    20|    10|     0|     0|    10|     0|       0|       0|      20|       0|      10|      50|\n|emix_norm |    60|    70|     0|    30|    20|     0|    20|    30|     0|      50|      40|       0|      70|      10|       0|\n|norm_logn |    10|    20|    10|    30|    20|    10|    50|    20|    10|      60|      80|      10|      80|      60|      40|\n|logn_logn |    20|    10|     0|     0|     0|    10|    30|    10|    10|       0|      30|       0|      30|      60|      50|\n|exp1_logn |    10|    10|     0|    20|     0|     0|    10|    10|    10|      20|      40|      10|      10|      30|       0|\n|exp2_logn |    10|    50|    10|    10|    30|    10|    20|    10|    10|      20|       0|      10|      30|      30|      30|\n|emix_logn |    10|    40|     0|    10|    40|     0|    10|    30|    10|       0|      20|       0|       0|       0|      10|\n|norm_exp1 |    60|    60|     0|    40|    20|    10|    80|    10|    10|      40|      30|      10|      50|      50|      10|\n|logn_exp1 |    10|    20|    20|    10|     0|     0|    50|    10|    10|       0|       0|       0|      20|      20|      20|\n|exp1_exp1 |    10|     0|     0|    10|    10|    10|    10|    30|    30|      10|      10|      10|      20|      30|      30|\n|exp2_exp1 |    10|    20|    10|    10|    10|     0|    20|    10|     0|       0|       0|      10|       0|       0|      20|\n|emix_exp1 |    40|    40|     0|    10|    20|    10|    30|    10|    10|       0|      20|       0|       0|       0|      10|\n|norm_exp2 |    20|    10|    10|    90|    60|    10|    70|    10|     0|      50|      30|      10|      70|      60|      30|\n|logn_exp2 |     0|    30|    20|    10|    10|     0|    60|     0|     0|      10|      40|      10|      50|      70|      50|\n|exp1_exp2 |     0|    30|    10|    10|    30|     0|    50|    10|    10|      10|      40|      20|      30|      80|      40|\n|exp2_exp2 |     0|    10|     0|    10|    10|     0|    40|    10|    10|      20|      90|      50|      10|      90|      80|\n|emix_exp2 |    20|    80|     0|    10|    10|    10|    20|    30|     0|       0|       0|       0|       0|      90|       0|\n|norm_emix |    70|    30|    10|    80|    80|     0|   100|   100|     0|      90|      60|       0|     100|      70|       0|\n|logn_emix |    10|    70|     0|    50|    50|     0|   100|    70|     0|      40|      80|       0|      50|     100|       0|\n|exp1_emix |    30|    70|     0|    40|    50|     0|   100|    80|     0|      30|      70|       0|      60|      90|       0|\n|exp2_emix |    20|    80|     0|    50|    60|     0|   100|     0|     0|       0|     100|      10|      40|      90|      20|\n|emix_emix |     0|     0|     0|    30|     0|     0|   100|     0|     0|      20|      90|       0|      10|      90|       0|\n:::\n:::\n\n\\normalsize\n",
    "supporting": [
      "t-test_vs_wilcoxon_files/figure-commonmark"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}